.align 4

.section .bss
# interrupt struct
.int_struct:
.long $0
.long $0

.section .text

# no error macro definition
.macro INT_HANDLE_NOERR num
.global int_handler_\num
int_handler_\num:
	cli
	pusha
	movl $0, .int_struct
	movl $\num, .int_struct + 4
	jmp .int_all
.endm

# error macro definition
.macro INT_HANDLE_ERR num
.global int_handler_\num
int_handler_\num:
	cli
	pusha
	pop %eax
	movl %eax, .int_struct
	movl $\num, .int_struct + 4
	jmp .int_all
.endm

INT_HANDLE_NOERR 0
INT_HANDLE_NOERR 1
INT_HANDLE_NOERR 2
INT_HANDLE_NOERR 3
INT_HANDLE_NOERR 4
INT_HANDLE_NOERR 5
INT_HANDLE_NOERR 6
INT_HANDLE_NOERR 7
INT_HANDLE_ERR 8
INT_HANDLE_NOERR 9
INT_HANDLE_ERR 10
INT_HANDLE_ERR 11
INT_HANDLE_ERR 12
INT_HANDLE_ERR 13
INT_HANDLE_ERR 14
INT_HANDLE_NOERR 15
INT_HANDLE_NOERR 16
INT_HANDLE_NOERR 17
INT_HANDLE_NOERR 18
INT_HANDLE_NOERR 19
INT_HANDLE_NOERR 20
INT_HANDLE_NOERR 21
INT_HANDLE_NOERR 22
INT_HANDLE_NOERR 23
INT_HANDLE_NOERR 24
INT_HANDLE_NOERR 25
INT_HANDLE_NOERR 26
INT_HANDLE_NOERR 27
INT_HANDLE_NOERR 28
INT_HANDLE_NOERR 29
INT_HANDLE_NOERR 30
INT_HANDLE_NOERR 31
INT_HANDLE_NOERR 32
INT_HANDLE_NOERR 33
INT_HANDLE_NOERR 34
INT_HANDLE_NOERR 35
INT_HANDLE_NOERR 36
INT_HANDLE_NOERR 37
INT_HANDLE_NOERR 38
INT_HANDLE_NOERR 39
INT_HANDLE_NOERR 40
INT_HANDLE_NOERR 41
INT_HANDLE_NOERR 42
INT_HANDLE_NOERR 43
INT_HANDLE_NOERR 44
INT_HANDLE_NOERR 45
INT_HANDLE_NOERR 46
INT_HANDLE_NOERR 47
INT_HANDLE_NOERR 48
INT_HANDLE_NOERR 49
INT_HANDLE_NOERR 50
INT_HANDLE_NOERR 51
INT_HANDLE_NOERR 52
INT_HANDLE_NOERR 53
INT_HANDLE_NOERR 54
INT_HANDLE_NOERR 55
INT_HANDLE_NOERR 56
INT_HANDLE_NOERR 57
INT_HANDLE_NOERR 58
INT_HANDLE_NOERR 59
INT_HANDLE_NOERR 60
INT_HANDLE_NOERR 61
INT_HANDLE_NOERR 62
INT_HANDLE_NOERR 63
INT_HANDLE_NOERR 64
INT_HANDLE_NOERR 65
INT_HANDLE_NOERR 66
INT_HANDLE_NOERR 67
INT_HANDLE_NOERR 68
INT_HANDLE_NOERR 69
INT_HANDLE_NOERR 70
INT_HANDLE_NOERR 71
INT_HANDLE_NOERR 72
INT_HANDLE_NOERR 73
INT_HANDLE_NOERR 74
INT_HANDLE_NOERR 75
INT_HANDLE_NOERR 76
INT_HANDLE_NOERR 77
INT_HANDLE_NOERR 78
INT_HANDLE_NOERR 79
INT_HANDLE_NOERR 80
INT_HANDLE_NOERR 81
INT_HANDLE_NOERR 82
INT_HANDLE_NOERR 83
INT_HANDLE_NOERR 84
INT_HANDLE_NOERR 85
INT_HANDLE_NOERR 86
INT_HANDLE_NOERR 87
INT_HANDLE_NOERR 88
INT_HANDLE_NOERR 89
INT_HANDLE_NOERR 90
INT_HANDLE_NOERR 91
INT_HANDLE_NOERR 92
INT_HANDLE_NOERR 93
INT_HANDLE_NOERR 94
INT_HANDLE_NOERR 95
INT_HANDLE_NOERR 96
INT_HANDLE_NOERR 97
INT_HANDLE_NOERR 98
INT_HANDLE_NOERR 99
INT_HANDLE_NOERR 100
INT_HANDLE_NOERR 101
INT_HANDLE_NOERR 102
INT_HANDLE_NOERR 103
INT_HANDLE_NOERR 104
INT_HANDLE_NOERR 105
INT_HANDLE_NOERR 106
INT_HANDLE_NOERR 107
INT_HANDLE_NOERR 108
INT_HANDLE_NOERR 109
INT_HANDLE_NOERR 110
INT_HANDLE_NOERR 111
INT_HANDLE_NOERR 112
INT_HANDLE_NOERR 113
INT_HANDLE_NOERR 114
INT_HANDLE_NOERR 115
INT_HANDLE_NOERR 116
INT_HANDLE_NOERR 117
INT_HANDLE_NOERR 118
INT_HANDLE_NOERR 119
INT_HANDLE_NOERR 120
INT_HANDLE_NOERR 121
INT_HANDLE_NOERR 122
INT_HANDLE_NOERR 123
INT_HANDLE_NOERR 124
INT_HANDLE_NOERR 125
INT_HANDLE_NOERR 126
INT_HANDLE_NOERR 127
INT_HANDLE_NOERR 128
INT_HANDLE_NOERR 129
INT_HANDLE_NOERR 130
INT_HANDLE_NOERR 131
INT_HANDLE_NOERR 132
INT_HANDLE_NOERR 133
INT_HANDLE_NOERR 134
INT_HANDLE_NOERR 135
INT_HANDLE_NOERR 136
INT_HANDLE_NOERR 137
INT_HANDLE_NOERR 138
INT_HANDLE_NOERR 139
INT_HANDLE_NOERR 140
INT_HANDLE_NOERR 141
INT_HANDLE_NOERR 142
INT_HANDLE_NOERR 143
INT_HANDLE_NOERR 144
INT_HANDLE_NOERR 145
INT_HANDLE_NOERR 146
INT_HANDLE_NOERR 147
INT_HANDLE_NOERR 148
INT_HANDLE_NOERR 149
INT_HANDLE_NOERR 150
INT_HANDLE_NOERR 151
INT_HANDLE_NOERR 152
INT_HANDLE_NOERR 153
INT_HANDLE_NOERR 154
INT_HANDLE_NOERR 155
INT_HANDLE_NOERR 156
INT_HANDLE_NOERR 157
INT_HANDLE_NOERR 158
INT_HANDLE_NOERR 159
INT_HANDLE_NOERR 160
INT_HANDLE_NOERR 161
INT_HANDLE_NOERR 162
INT_HANDLE_NOERR 163
INT_HANDLE_NOERR 164
INT_HANDLE_NOERR 165
INT_HANDLE_NOERR 166
INT_HANDLE_NOERR 167
INT_HANDLE_NOERR 168
INT_HANDLE_NOERR 169
INT_HANDLE_NOERR 170
INT_HANDLE_NOERR 171
INT_HANDLE_NOERR 172
INT_HANDLE_NOERR 173
INT_HANDLE_NOERR 174
INT_HANDLE_NOERR 175
INT_HANDLE_NOERR 176
INT_HANDLE_NOERR 177
INT_HANDLE_NOERR 178
INT_HANDLE_NOERR 179
INT_HANDLE_NOERR 180
INT_HANDLE_NOERR 181
INT_HANDLE_NOERR 182
INT_HANDLE_NOERR 183
INT_HANDLE_NOERR 184
INT_HANDLE_NOERR 185
INT_HANDLE_NOERR 186
INT_HANDLE_NOERR 187
INT_HANDLE_NOERR 188
INT_HANDLE_NOERR 189
INT_HANDLE_NOERR 190
INT_HANDLE_NOERR 191
INT_HANDLE_NOERR 192
INT_HANDLE_NOERR 193
INT_HANDLE_NOERR 194
INT_HANDLE_NOERR 195
INT_HANDLE_NOERR 196
INT_HANDLE_NOERR 197
INT_HANDLE_NOERR 198
INT_HANDLE_NOERR 199
INT_HANDLE_NOERR 200
INT_HANDLE_NOERR 201
INT_HANDLE_NOERR 202
INT_HANDLE_NOERR 203
INT_HANDLE_NOERR 204
INT_HANDLE_NOERR 205
INT_HANDLE_NOERR 206
INT_HANDLE_NOERR 207
INT_HANDLE_NOERR 208
INT_HANDLE_NOERR 209
INT_HANDLE_NOERR 210
INT_HANDLE_NOERR 211
INT_HANDLE_NOERR 212
INT_HANDLE_NOERR 213
INT_HANDLE_NOERR 214
INT_HANDLE_NOERR 215
INT_HANDLE_NOERR 216
INT_HANDLE_NOERR 217
INT_HANDLE_NOERR 218
INT_HANDLE_NOERR 219
INT_HANDLE_NOERR 220
INT_HANDLE_NOERR 221
INT_HANDLE_NOERR 222
INT_HANDLE_NOERR 223
INT_HANDLE_NOERR 224
INT_HANDLE_NOERR 225
INT_HANDLE_NOERR 226
INT_HANDLE_NOERR 227
INT_HANDLE_NOERR 228
INT_HANDLE_NOERR 229
INT_HANDLE_NOERR 230
INT_HANDLE_NOERR 231
INT_HANDLE_NOERR 232
INT_HANDLE_NOERR 233
INT_HANDLE_NOERR 234
INT_HANDLE_NOERR 235
INT_HANDLE_NOERR 236
INT_HANDLE_NOERR 237
INT_HANDLE_NOERR 238
INT_HANDLE_NOERR 239
INT_HANDLE_NOERR 240
INT_HANDLE_NOERR 241
INT_HANDLE_NOERR 242
INT_HANDLE_NOERR 243
INT_HANDLE_NOERR 244
INT_HANDLE_NOERR 245
INT_HANDLE_NOERR 246
INT_HANDLE_NOERR 247
INT_HANDLE_NOERR 248
INT_HANDLE_NOERR 249
INT_HANDLE_NOERR 250
INT_HANDLE_NOERR 251
INT_HANDLE_NOERR 252
INT_HANDLE_NOERR 253
INT_HANDLE_NOERR 254

# does actual handler call
.int_all:
	# set up stack for call
	push %ebp
	mov %esp, %ebp

	# call & cleanup stack
	push $.int_struct
	push $kern0
	call int_handler
	add $8, %esp
	pop %ebp

	# retrieve state, turn interrupts on, and return
	popa
	sti
	iret
